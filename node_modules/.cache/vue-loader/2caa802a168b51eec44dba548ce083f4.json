{"remainingRequest":"D:\\vue-project\\xdclass_front\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js??vue-loader-options!D:\\vue-project\\xdclass_front\\node_modules\\_cube-ui@1.12.44@cube-ui\\src\\components\\upload\\upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\vue-project\\xdclass_front\\node_modules\\_cube-ui@1.12.44@cube-ui\\src\\components\\upload\\upload.vue","mtime":499162500000},{"path":"D:\\vue-project\\xdclass_front\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vue-project\\xdclass_front\\node_modules\\_babel-loader@8.2.2@babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\vue-project\\xdclass_front\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vue-project\\xdclass_front\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBVcGxvYWRCdG4gZnJvbSAnLi9idG4udnVlJwppbXBvcnQgVXBsb2FkRmlsZSBmcm9tICcuL2ZpbGUudnVlJwppbXBvcnQgYWpheFVwbG9hZCBmcm9tICcuL2FqYXgnCmltcG9ydCBidG5NaXhpbiBmcm9tICcuL2J0bi1taXhpbicKaW1wb3J0IHsKICBwcm9jZXNzRmlsZXMsCiAgbmV3RmlsZSwKICBVUkwsCiAgU1RBVFVTX1JFQURZLAogIFNUQVRVU19VUExPQURJTkcsCiAgU1RBVFVTX0VSUk9SLAogIFNUQVRVU19TVUNDRVNTCn0gZnJvbSAnLi91dGlsJwoKY29uc3QgQ09NUE9ORU5UX05BTUUgPSAnY3ViZS11cGxvYWQnCmNvbnN0IEVWRU5UX0lOUFVUID0gJ2lucHV0Jwpjb25zdCBFVkVOVF9BRERFRCA9ICdmaWxlcy1hZGRlZCcKY29uc3QgRVZFTlRfU1VCTUlUVEVEID0gJ2ZpbGUtc3VibWl0dGVkJwpjb25zdCBFVkVOVF9SRU1PVkVEID0gJ2ZpbGUtcmVtb3ZlZCcKY29uc3QgRVZFTlRfU1VDQ0VTUyA9ICdmaWxlLXN1Y2Nlc3MnCmNvbnN0IEVWRU5UX0VSUk9SID0gJ2ZpbGUtZXJyb3InCmNvbnN0IEVWRU5UX0NMSUNLID0gJ2ZpbGUtY2xpY2snCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogQ09NUE9ORU5UX05BTUUsCiAgbWl4aW5zOiBbYnRuTWl4aW5dLAogIHByb3BzOiB7CiAgICB2YWx1ZTogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gW10KICAgICAgfQogICAgfSwKICAgIGFjdGlvbjogewogICAgICB0eXBlOiBbU3RyaW5nLCBPYmplY3RdLAogICAgICBkZWZhdWx0OiAnJwogICAgfSwKICAgIG1heDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDEwCiAgICB9LAogICAgYXV0bzogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAogICAgc2ltdWx0YW5lb3VzVXBsb2FkczogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDEKICAgIH0sCiAgICBwcm9jZXNzRmlsZTogewogICAgICB0eXBlOiBGdW5jdGlvbiwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gKGZpbGUsIGNiKSB7CiAgICAgICAgY2IoZmlsZSkKICAgICAgfQogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGZpbGVzOiB0aGlzLnZhbHVlLAogICAgICBwYXVzZWQ6ICF0aGlzLmF1dG8KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBhY3Rpb25PcHRpb25zKCkgewogICAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmFjdGlvbgogICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gJ3N0cmluZycpIHsKICAgICAgICByZXR1cm4gYWN0aW9uID8gewogICAgICAgICAgdGFyZ2V0OiBhY3Rpb24KICAgICAgICB9IDogbnVsbAogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBhY3Rpb24KICAgICAgfQogICAgfSwKICAgIGlzU2hvd0J0bigpIHsKICAgICAgcmV0dXJuIHRoaXMuZmlsZXMubGVuZ3RoIDwgdGhpcy5tYXgKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICB2YWx1ZShuZXdWYWwpIHsKICAgICAgdGhpcy5maWxlcyA9IG5ld1ZhbAogICAgfSwKICAgIGZpbGVzKG5ld0ZpbGVzKSB7CiAgICAgIHRoaXMuJGVtaXQoRVZFTlRfSU5QVVQsIG5ld0ZpbGVzKQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgYWRkRmlsZXMoZmlsZXMpIHsKICAgICAgdGhpcy4kZW1pdChFVkVOVF9BRERFRCwgZmlsZXMpCiAgICAgIGNvbnN0IGZpbGVzTGVuID0gdGhpcy5maWxlcy5sZW5ndGgKICAgICAgY29uc3QgbmV3RmlsZXMgPSBbXQogICAgICBjb25zdCBtYXhMZW4gPSB0aGlzLm1heCAtIGZpbGVzTGVuCiAgICAgIGxldCBpID0gMAogICAgICBsZXQgZmlsZSA9IGZpbGVzW2ldCiAgICAgIHdoaWxlIChuZXdGaWxlcy5sZW5ndGggPCBtYXhMZW4gJiYgZmlsZSkgewogICAgICAgIGlmICghZmlsZS5pZ25vcmUpIHsKICAgICAgICAgIG5ld0ZpbGVzLnB1c2goZmlsZSkKICAgICAgICAgIHRoaXMuZmlsZXMucHVzaChuZXdGaWxlKCkpCiAgICAgICAgfQogICAgICAgIGZpbGUgPSBmaWxlc1srK2ldCiAgICAgIH0KICAgICAgcHJvY2Vzc0ZpbGVzKG5ld0ZpbGVzLCB0aGlzLnByb2Nlc3NGaWxlLCAoZmlsZSwgaW5kZXgpID0+IHsKICAgICAgICB0aGlzLiRzZXQodGhpcy5maWxlcywgZmlsZXNMZW4gKyBpbmRleCwgZmlsZSkKICAgICAgICB0aGlzLiRlbWl0KEVWRU5UX1NVQk1JVFRFRCwgZmlsZSkKICAgICAgfSwgKCkgPT4gewogICAgICAgIC8vIHdhaXRpbmcgdWkKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLnVwbG9hZCgpCiAgICAgICAgfSkKICAgICAgfSkKICAgIH0sCiAgICByZW1vdmVGaWxlKGZpbGUpIHsKICAgICAgdGhpcy4kZW1pdChFVkVOVF9SRU1PVkVELCBmaWxlKQogICAgICBmaWxlLl94aHIgJiYgZmlsZS5feGhyLmFib3J0KCkKICAgICAgaWYgKGZpbGUudXJsKSB7CiAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChmaWxlLnVybCkKICAgICAgfQogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZmlsZXMuaW5kZXhPZihmaWxlKQogICAgICB0aGlzLmZpbGVzLnNwbGljZShpbmRleCwgMSkKICAgICAgdGhpcy51cGxvYWQoKQogICAgfSwKICAgIGZpbGVDbGljayhmaWxlLCBpbmRleCkgewogICAgICB0aGlzLiRlbWl0KEVWRU5UX0NMSUNLLCBmaWxlLCBpbmRleCkKICAgIH0sCiAgICB1cGxvYWQocmV0cnkpIHsKICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuYWN0aW9uT3B0aW9ucwogICAgICBpZiAodGhpcy5wYXVzZWQgfHwgIW9wdGlvbnMpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBjb25zdCBsZW4gPSB0aGlzLmZpbGVzLmxlbmd0aAogICAgICBsZXQgdXBsb2FkaW5nQ291bnQgPSAwCiAgICAgIGxldCBpID0gMAogICAgICB3aGlsZSAoaSA8IGxlbiAmJiB1cGxvYWRpbmdDb3VudCA8IHRoaXMuc2ltdWx0YW5lb3VzVXBsb2FkcykgewogICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmZpbGVzW2ldCiAgICAgICAgY29uc3Qgc3RhdHVzID0gZmlsZS5zdGF0dXMKICAgICAgICBpZiAoc3RhdHVzID09PSBTVEFUVVNfUkVBRFkgfHwgKHJldHJ5ICYmIHN0YXR1cyA9PT0gU1RBVFVTX0VSUk9SICYmIGZpbGUuX3JldHJ5SWQgIT09IHRoaXMucmV0cnlJZCkpIHsKICAgICAgICAgIGFqYXhVcGxvYWQoZmlsZSwgb3B0aW9ucywgKGZpbGUpID0+IHsKICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gU1RBVFVTX0VSUk9SKSB7CiAgICAgICAgICAgICAgZmlsZS5fcmV0cnlJZCA9IHRoaXMucmV0cnlJZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJGVtaXQoZmlsZS5zdGF0dXMgPT09IFNUQVRVU19TVUNDRVNTID8gRVZFTlRfU1VDQ0VTUyA6IEVWRU5UX0VSUk9SLCBmaWxlKQogICAgICAgICAgICB0aGlzLnVwbG9hZChyZXRyeSkKICAgICAgICAgIH0pCiAgICAgICAgICB1cGxvYWRpbmdDb3VudCsrCiAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFNUQVRVU19VUExPQURJTkcpIHsKICAgICAgICAgIHVwbG9hZGluZ0NvdW50KysKICAgICAgICB9CiAgICAgICAgaSsrCiAgICAgIH0KICAgIH0sCiAgICBzdGFydCgpIHsKICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZQogICAgICB0aGlzLnVwbG9hZCgpCiAgICB9LAogICAgcGF1c2UoKSB7CiAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZQogICAgICB0aGlzLmZpbGVzLmZvckVhY2goKGZpbGUpID0+IHsKICAgICAgICBpZiAoZmlsZS5zdGF0dXMgPT09IFNUQVRVU19VUExPQURJTkcpIHsKICAgICAgICAgIGZpbGUuX3hoci5hYm9ydCgpCiAgICAgICAgICBmaWxlLnN0YXR1cyA9IFNUQVRVU19SRUFEWQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICByZXRyeSgpIHsKICAgICAgdGhpcy5yZXRyeUlkID0gRGF0ZS5ub3coKQogICAgICB0aGlzLnBhdXNlZCA9IGZhbHNlCiAgICAgIHRoaXMudXBsb2FkKHRydWUpCiAgICB9CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBVcGxvYWRCdG4sCiAgICBVcGxvYWRGaWxlCiAgfQp9Cg=="},{"version":3,"sources":["upload.vue"],"names":[],"mappings":";;;;;;;;;;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upload.vue","sourceRoot":"node_modules/_cube-ui@1.12.44@cube-ui/src/components/upload","sourcesContent":["<template>\n  <div class=\"cube-upload\">\n    <slot>\n      <div class=\"cube-upload-def clear-fix\">\n        <upload-file v-for=\"(file, i) in files\" :file=\"file\" :key=\"i\" @click=\"fileClick(file, i)\"></upload-file>\n        <upload-btn :multiple=\"multiple\" :accept=\"accept\" v-show=\"isShowBtn\"></upload-btn>\n      </div>\n    </slot>\n  </div>\n</template>\n<script type=\"text/ecmascript-6\">\n  import UploadBtn from './btn.vue'\n  import UploadFile from './file.vue'\n  import ajaxUpload from './ajax'\n  import btnMixin from './btn-mixin'\n  import {\n    processFiles,\n    newFile,\n    URL,\n    STATUS_READY,\n    STATUS_UPLOADING,\n    STATUS_ERROR,\n    STATUS_SUCCESS\n  } from './util'\n\n  const COMPONENT_NAME = 'cube-upload'\n  const EVENT_INPUT = 'input'\n  const EVENT_ADDED = 'files-added'\n  const EVENT_SUBMITTED = 'file-submitted'\n  const EVENT_REMOVED = 'file-removed'\n  const EVENT_SUCCESS = 'file-success'\n  const EVENT_ERROR = 'file-error'\n  const EVENT_CLICK = 'file-click'\n\n  export default {\n    name: COMPONENT_NAME,\n    mixins: [btnMixin],\n    props: {\n      value: {\n        type: Array,\n        default() {\n          return []\n        }\n      },\n      action: {\n        type: [String, Object],\n        default: ''\n      },\n      max: {\n        type: Number,\n        default: 10\n      },\n      auto: {\n        type: Boolean,\n        default: true\n      },\n      simultaneousUploads: {\n        type: Number,\n        default: 1\n      },\n      processFile: {\n        type: Function,\n        default: function (file, cb) {\n          cb(file)\n        }\n      }\n    },\n    data() {\n      return {\n        files: this.value,\n        paused: !this.auto\n      }\n    },\n    computed: {\n      actionOptions() {\n        const action = this.action\n        if (typeof action === 'string') {\n          return action ? {\n            target: action\n          } : null\n        } else {\n          return action\n        }\n      },\n      isShowBtn() {\n        return this.files.length < this.max\n      }\n    },\n    watch: {\n      value(newVal) {\n        this.files = newVal\n      },\n      files(newFiles) {\n        this.$emit(EVENT_INPUT, newFiles)\n      }\n    },\n    methods: {\n      addFiles(files) {\n        this.$emit(EVENT_ADDED, files)\n        const filesLen = this.files.length\n        const newFiles = []\n        const maxLen = this.max - filesLen\n        let i = 0\n        let file = files[i]\n        while (newFiles.length < maxLen && file) {\n          if (!file.ignore) {\n            newFiles.push(file)\n            this.files.push(newFile())\n          }\n          file = files[++i]\n        }\n        processFiles(newFiles, this.processFile, (file, index) => {\n          this.$set(this.files, filesLen + index, file)\n          this.$emit(EVENT_SUBMITTED, file)\n        }, () => {\n          // waiting ui\n          this.$nextTick(() => {\n            this.upload()\n          })\n        })\n      },\n      removeFile(file) {\n        this.$emit(EVENT_REMOVED, file)\n        file._xhr && file._xhr.abort()\n        if (file.url) {\n          URL.revokeObjectURL(file.url)\n        }\n        const index = this.files.indexOf(file)\n        this.files.splice(index, 1)\n        this.upload()\n      },\n      fileClick(file, index) {\n        this.$emit(EVENT_CLICK, file, index)\n      },\n      upload(retry) {\n        const options = this.actionOptions\n        if (this.paused || !options) {\n          return\n        }\n        const len = this.files.length\n        let uploadingCount = 0\n        let i = 0\n        while (i < len && uploadingCount < this.simultaneousUploads) {\n          const file = this.files[i]\n          const status = file.status\n          if (status === STATUS_READY || (retry && status === STATUS_ERROR && file._retryId !== this.retryId)) {\n            ajaxUpload(file, options, (file) => {\n              if (status === STATUS_ERROR) {\n                file._retryId = this.retryId\n              }\n              this.$emit(file.status === STATUS_SUCCESS ? EVENT_SUCCESS : EVENT_ERROR, file)\n              this.upload(retry)\n            })\n            uploadingCount++\n          } else if (status === STATUS_UPLOADING) {\n            uploadingCount++\n          }\n          i++\n        }\n      },\n      start() {\n        this.paused = false\n        this.upload()\n      },\n      pause() {\n        this.paused = true\n        this.files.forEach((file) => {\n          if (file.status === STATUS_UPLOADING) {\n            file._xhr.abort()\n            file.status = STATUS_READY\n          }\n        })\n      },\n      retry() {\n        this.retryId = Date.now()\n        this.paused = false\n        this.upload(true)\n      }\n    },\n    components: {\n      UploadBtn,\n      UploadFile\n    }\n  }\n</script>\n<style lang=\"stylus\" rel=\"stylesheet/stylus\">\n  @require \"../../common/stylus/variable.styl\"\n  .cube-upload\n    position: relative\n\n  .cube-upload-def\n    margin-right: -10px\n    .cube-upload-btn, .cube-upload-file\n      float: left\n      margin: 0 10px 10px 0\n</style>\n"]}]}